[pytest]
# Pytest Configuration for Lead Pipeline

# Test Discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Output Options
addopts =
    # Verbose output
    -v
    # Show summary of all test outcomes
    -ra
    # Show local variables in tracebacks
    --showlocals
    # Enable strict markers
    --strict-markers
    # Coverage reporting
    --cov=lead_pipeline
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml
    # Fail if coverage below threshold
    --cov-fail-under=50
    # Warnings
    -W error::DeprecationWarning
    -W error::PendingDeprecationWarning

# Test Markers
markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (slower, external deps)
    e2e: End-to-end tests (slowest, full pipeline)
    slow: Tests that take > 1 second
    circuit_breaker: Tests for circuit breaker logic
    state_manager: Tests for state persistence
    http: Tests for HTTP utilities
    supabase: Tests requiring Supabase mock
    hubspot: Tests requiring HubSpot mock
    webhook: Tests requiring webhook mock
    smoke: Quick smoke tests for CI

# Timeouts
timeout = 30
timeout_method = thread

# Coverage Options
[coverage:run]
source = .
omit =
    */tests/*
    */venv/*
    */.venv/*
    */site-packages/*
    setup.py

[coverage:report]
precision = 2
skip_empty = true
sort = Cover

[coverage:html]
directory = htmlcov
